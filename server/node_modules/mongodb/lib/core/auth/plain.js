'use strict';
<<<<<<< HEAD
=======

>>>>>>> 294d75090c0670d1606c5984e2bdb3ac5fc7c2c2
const retrieveBSON = require('../connection/utils').retrieveBSON;
const AuthProvider = require('./auth_provider').AuthProvider;

// TODO: can we get the Binary type from this.bson instead?
const BSON = retrieveBSON();
const Binary = BSON.Binary;

<<<<<<< HEAD
class Plain extends AuthProvider {
  auth(authContext, callback) {
    const connection = authContext.connection;
    const credentials = authContext.credentials;
    const username = credentials.username;
    const password = credentials.password;

=======
/**
 * Creates a new Plain authentication mechanism
 *
 * @extends AuthProvider
 */
class Plain extends AuthProvider {
  /**
   * Implementation of authentication for a single connection
   * @override
   */
  _authenticateSingleConnection(sendAuthCommand, connection, credentials, callback) {
    const username = credentials.username;
    const password = credentials.password;
>>>>>>> 294d75090c0670d1606c5984e2bdb3ac5fc7c2c2
    const payload = new Binary(`\x00${username}\x00${password}`);
    const command = {
      saslStart: 1,
      mechanism: 'PLAIN',
      payload: payload,
      autoAuthorize: 1
    };

<<<<<<< HEAD
    connection.command('$external.$cmd', command, callback);
=======
    sendAuthCommand(connection, '$external.$cmd', command, callback);
>>>>>>> 294d75090c0670d1606c5984e2bdb3ac5fc7c2c2
  }
}

module.exports = Plain;
